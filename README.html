<!DOCTYPE html><html><head><meta charset="utf-8"><title>Tstat-DPDK Readme</title>
</head>

<style>
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-mdh,
.markdown-body .pl-mm,
.markdown-body .pl-mp,
.markdown-body .pl-mr,
.markdown-body .pl-s1 .pl-v,
.markdown-body .pl-s3,
.markdown-body .pl-sc,
.markdown-body .pl-sv {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s1 .pl-s2,
.markdown-body .pl-smi,
.markdown-body .pl-smp,
.markdown-body .pl-stj,
.markdown-body .pl-vo,
.markdown-body .pl-vpf {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k,
.markdown-body .pl-s,
.markdown-body .pl-st {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s1,
.markdown-body .pl-s1 .pl-pse .pl-s2,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre,
.markdown-body .pl-src,
.markdown-body .pl-v {
  color: #df5000;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md,
.markdown-body .pl-mdhf {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mdht,
.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #000;
  border: 1px solid #cfcfcf;
  border-radius: 2px;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4183c4;
}
    .markdown-body {
        min-width: 200px;
        max-width: 790px;
        margin: 0 auto;
        padding: 30px;
    }
</style>
<body class="markdown-body">



<h1 id="tstat-dpdk">Tstat-DPDK</h1>
<h1 id="1-description-of-the-software">1. Description of the software</h1>
<p>This program is a particular version of Tstat which uses Intel Data Plane Development Kit to retreive packets from network interfaces (NICs).
It uses a multicore approach to achieve high speed. So it&#39;s important to know the number of cores you CPU has.
It starts several <strong>indipendent instances of Tstat</strong>. Each instance will be fed by a portion of the incoming traffic.
So the each Tstat instance produces its own output in different directories.</p>
<ul>
<li>To understand Tstat please read: <a href="http://tstat.polito.it/HOWTO.shtml">http://tstat.polito.it/HOWTO.shtml</a></li>
<li>For information about DPDK please read: <a href="http://dpdk.org/doc">http://dpdk.org/doc</a></li>
<li>For information about this Readme file and Tstat-DPDK please write to <a href="mailto:martino.trevisan@studenti.polito.it">martino.trevisan@studenti.polito.it</a></li>
</ul>
<h1 id="2-requirements">2. Requirements</h1>
<ul>
<li>A machine with 82599 based network interfaces.</li>
<li>A Debian based Linux distribution with kernel &gt;= 2.6.3</li>
<li>Linux kernel headers: to install type<pre><code class="lang-bash">  <span class="hljs-built_in">sudo</span> apt-get install linux-headers-$(uname -r)
</code></pre>
</li>
<li>Several package needed before installing this software:<ul>
<li>DPDK needs: <code>make, cmp, sed, grep, arch, glibc.i686, libgcc.i686, libstdc++.i686, glibc-devel.i686, python</code></li>
<li>Tstat needs: <code>libpcap-dev, rrdtool, librrd-dev, cpufrequtils, autoconf, libtool, subversion</code></li>
</ul>
</li>
</ul>
<h1 id="3-installation">3. Installation</h1>
<h2 id="3-1-install-dpdk">3.1 Install DPDK</h2>
<p>Install DPDK 1.7.1. With other versions is not guaranted it works properly.
Make the enviroment variable <code>RTE_SDK</code> and <code>RTE_TARGET</code> to point respectively to DPDK installation directory and compilation target.
For documentation and details see <a href="http://dpdk.org/doc/intel/dpdk-start-linux-1.7.0.pdf">http://dpdk.org/doc/intel/dpdk-start-linux-1.7.0.pdf</a></p>
<pre><code class="lang-bash">    wget http://dpdk.org/browse/dpdk/snapshot/dpdk-<span class="hljs-number">1.7</span>.<span class="hljs-number">1</span>.tar.gz
    tar xzf dpdk-<span class="hljs-number">1.7</span>.<span class="hljs-number">1</span>.tar.gz
    <span class="hljs-built_in">cd</span> dpdk-<span class="hljs-number">1.7</span>.<span class="hljs-number">1</span>
    <span class="hljs-keyword">export</span> RTE_SDK=$(<span class="hljs-built_in">pwd</span>)
    <span class="hljs-keyword">export</span> RTE_TARGET=x86_64-native-linuxapp-gcc
    make install T=<span class="hljs-variable">$RTE_TARGET</span>
    <span class="hljs-built_in">cd</span> ..
</code></pre>
<p><strong>NOTE:</strong> if you are running on a i686 machine, please use <code>i686-native-linuxapp-gcc</code> as <code>RTE_TARGET</code></p>
<h2 id="3-2-install-tstat-dpdk">3.2 Install Tstat-DPDK</h2>
<p>This operation requires super user privileges.</p>
<pre><code class="lang-bash">    svn co http://tstat.polito.it/svn/software/tstat/branches/tstat-dpdk/
    <span class="hljs-built_in">cd</span> tstat-dpdk/tstat-<span class="hljs-number">3.0</span>r648
    ./autogen.sh
    ./configure --enable-libtstat
    make
    <span class="hljs-built_in">sudo</span> make install
    <span class="hljs-built_in">cd</span> ../one_copy_cluster_dpdk
    make clean &amp;&amp; make
    <span class="hljs-built_in">cd</span> ../..
</code></pre>
<p><strong>NOTE 1:</strong> be sure that when running <code>./configure --enable-libtstat</code> you get this output</p>
<pre><code>-------------------------------------------------
  tstat Version 3.0
  -lpcap -lpthread -lm  -lrrd

  Prefix: &#39;/usr/local&#39;

  Package features:
    - pcap      yes
    - zlib      no
    - rrd       yes
    - libtstat  yes
--------------------------------------------------
</code></pre><p>This means that <code>libpcap</code> and <code>rrdtool</code> have been detected and <code>libtstat</code> compilation enabled.</p>
<p><strong>NOTE 2:</strong> if, when running Tstat-DPDK, you encounter an error like this</p>
<pre><code>    error while loading shared libraries: libtstat.so.0: cannot open shared object file: No such file or directory
</code></pre><p>run this command to make the enviroment to find <code>libstat</code> shared object:</p>
<pre><code class="lang-bash">    <span class="hljs-keyword">export</span> LD_LIBRARY_PATH=/usr/local/lib
</code></pre>
<h1 id="4-configuration-of-the-machine">4. Configuration of the machine</h1>
<p>Before running Tstat-DPDK there are few things to do.</p>
<p><strong>NOTE:</strong> The steps 4.1, 4.2 and 4.3 can be automatically accomplished by the script <code>installation-dir/one_copy_cluster_dpdk/scripts/configure_machine.sh</code>.
Please verify that script is doing the right operation for your system.</p>
<h2 id="4-1-reserve-a-big-number-of-hugepages-to-dpdk">4.1 Reserve a big number of hugepages to DPDK</h2>
<p>The commands below reserve 6144 hugepages. Reserve about 512 * N, where N is the number of cores of your machine. The size of each huge page is 2MB. Check to have enough RAM on your machine.</p>
<pre><code class="lang-bash">    <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">echo</span> <span class="hljs-number">6144</span> &gt; <span class="hljs-built_in">sudo</span> /sys/kernel/mm/hugepages/hugepages-<span class="hljs-number">2048</span>kB/nr_hugepages
    <span class="hljs-built_in">sudo</span> mkdir -p /mnt/huge
    <span class="hljs-built_in">sudo</span> mount -t hugetlbfs nodev /mnt/huge
</code></pre>
<h2 id="4-2-set-cpu-on-performance-governor">4.2 Set CPU on performance governor</h2>
<p>To achieve the best performance, your CPU must run always at the highest speed. You need to have installed <code>cpufrequtils</code> package.</p>
<pre><code class="lang-bash">    <span class="hljs-built_in">sudo</span> cpufreq-set -r -g performance
</code></pre>
<h2 id="4-3-bind-the-interfaces-you-want-to-use-with-dpdk-drivers">4.3  Bind the interfaces you want to use with DPDK drivers</h2>
<p>It means that you have to load DPDK driver and associate it to you network interface.
Tstat-DPDK reads packets from all the interfaces bound to DPDK.
Remember to set <code>RTE_SDK</code> and <code>RTE_TARGET</code> when executing the below commands.</p>
<pre><code class="lang-bash">    <span class="hljs-built_in">sudo</span> modprobe uio
    <span class="hljs-built_in">sudo</span> insmod <span class="hljs-variable">$RTE_SDK</span>/<span class="hljs-variable">$RTE_TARGET</span>/kmod/igb_uio.ko
    <span class="hljs-built_in">sudo</span> <span class="hljs-variable">$RTE_SDK</span>/tools/dpdk_nic_bind.py --bind=igb_uio $(<span class="hljs-variable">$RTE_SDK</span>/tools/dpdk_nic_bind.py --status | sed -rn <span class="hljs-string">'s,.* if=([^ ]*).*igb_uio *$,\1,p'</span>)
</code></pre>
<p>In this way all the DPDK-supported interfaces are working with DPDK drivers.
To check if your network interfaces have been properly set by the Intel DPDK enviroment run:</p>
<pre><code class="lang-bash">    <span class="hljs-built_in">sudo</span> <span class="hljs-variable">$RTE_SDK</span>/tools/dpdk_nic_bind.py --status
</code></pre>
<p>You should get an output like this, which means that the first two interfaces are running under DPDK driver, while the third is not:</p>
<pre><code>Network devices using DPDK-compatible driver
============================================
0000:04:00.0 &#39;Ethernet Controller 10-Gigabit X540-AT2&#39; drv=igb_uio unused=
0000:04:00.1 &#39;Ethernet Controller 10-Gigabit X540-AT2&#39; drv=igb_uio unused=
Network devices using kernel driver
===================================
0000:03:00.0 &#39;NetXtreme BCM5719 Gigabit Ethernet PCIe&#39; if=eth0 drv=tg3 unused=igb_uio *Active*
</code></pre><p><strong>NOTE:</strong> If for any reason you don&#39;t want to bind all the DPDK-supported interfaces to DPDK enviroment, use the <code>dpdk_nic_bind.py</code> as described in the DPDK getting started guide.</p>
<h2 id="4-4-set-up-tstat-configuration">4.4  Set up Tstat configuration</h2>
<p>In the directory <code>installation-dir/one_copy_cluster_dpdk/tstat-conf</code> there is a set of files: <code>tstat00.conf</code>, <code>tstat01.conf</code> ecc...
Those are the configuration files of each Tstat process. Configure it as you prefer; the default configuration includes all plugins, RRDTool engine and CryptoPAn anonymization.</p>
<p>Having one configuration file for each Tstat instance let you to specify different RRDTool directory for different instances.
This is necessary to make it work because each instance needs an its own RRD database and directory. 
By deafult these directories are <code>rrd_fastweb_liveXX</code> where XX is the number of the instance. Anyway RRD usage is not mandatory.</p>
<h1 id="5-usage">5. Usage</h1>
<h2 id="5-1-how-to-start-it">5.1 How to start it</h2>
<p>To start Tstat-DPDK <strong>go in <code>installation-dir/one_copy_cluster_dpdk</code>.</strong> Then use the provided script to start it.
Decide how many instances of Tstat-DPDK you want to run in parallel: a Tstat instance needs two cores.
If you want to start 2 instances, type:</p>
<pre><code class="lang-bash">    ./scripts/start_2_instances.sh
</code></pre>
<p>Approximatively every second, the system prints statistics about performance, one line for each instance.
The information are about average, maximum, and standard deviation of per-packet processing time. There is the number of TCP and UDP flows closed.
The output includes also the incoming rate in Mpps and the eventual packet loss rate (in case of losses). You can see also the occupation of the internal buffer.
The ouput has got this form.</p>
<pre><code>Instance: 0 Avg: 1.023us Max: 35.127us StdDev: 14.452 TCP cl.: 42 UDP cl.: 213 Rate: 0.897Mpps, Loss: 0Mpps Buffer occupation:   0%
Instance: 1 Avg: 1.045us Max: 44.345us StdDev: 45.713 TCP cl.: 37 UDP cl.: 175 Rate: 0.813Mpps, Loss: 0Mpps Buffer occupation:   0%
</code></pre><h2 id="5-2-how-to-stop-it">5.2 How to stop it</h2>
<p>To stop Tstat-DPDK, type:</p>
<pre><code class="lang-bash">    ./scripts/quit_instances.sh
</code></pre>
<p>The system will quit and it will print overall statistics on its working divided by network interface and by instance.
The output has this form.</p>
<pre><code>PORT: 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
PORT: 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%

INSTANCE: 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
TSTAT STATISTICS:
Total packets: 0
TCP flows: 0
UDP flows: 0
Time elapsed: 2880.317s

INSTANCE: 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
TSTAT STATISTICS:
Total packets: 0
TCP flows: 0
UDP flows: 0
Time elapsed: 2879.215s
</code></pre><h2 id="5-3-log-files-directory">5.3 Log files directory</h2>
<p>Tstat produces several log files for different events seen on the network.
Log files are keep separated for each instance and they are put in <code>installation-dir/one_copy_cluster_dpdk/tstatXX.log.out</code> where <code>XX</code> is the number of Tstat instance.
The name of these directories is hardcoded in the software and cannot be modified.</p>
<p>On the contrary, RRD database directory is specified in the configuration files of Tstat, so you can choose its location (remember: each instance must have its different database in different directories).</p>
<h2 id="5-4-system-performance-logs">5.4 System performance logs</h2>
<p>In the directory <code>installation-dir/one_copy_cluster_dpdk/tstat-stats</code> there is a set of file called <code>statsXX.txt</code>.
Each instance writes in its own file (the <code>XX</code> in the name of the file is its number) statistics while it is running.
There are 3 columns which are respectively the mean, the max and the standard deviation of the per packet processing time.</p>

</body></html>
