<!DOCTYPE html><html><head><meta charset="utf-8"><title>Tstat-DPDK Readme</title>
</head>

<style>
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-mdh,
.markdown-body .pl-mm,
.markdown-body .pl-mp,
.markdown-body .pl-mr,
.markdown-body .pl-s1 .pl-v,
.markdown-body .pl-s3,
.markdown-body .pl-sc,
.markdown-body .pl-sv {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s1 .pl-s2,
.markdown-body .pl-smi,
.markdown-body .pl-smp,
.markdown-body .pl-stj,
.markdown-body .pl-vo,
.markdown-body .pl-vpf {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k,
.markdown-body .pl-s,
.markdown-body .pl-st {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s1,
.markdown-body .pl-s1 .pl-pse .pl-s2,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre,
.markdown-body .pl-src,
.markdown-body .pl-v {
  color: #df5000;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md,
.markdown-body .pl-mdhf {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mdht,
.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #000;
  border: 1px solid #cfcfcf;
  border-radius: 2px;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4183c4;
}
    .markdown-body {
        min-width: 200px;
        max-width: 790px;
        margin: 0 auto;
        padding: 30px;
    }
</style>
<body class="markdown-body">






<h1 id="tstat-dpdk-quick-start-guide">Tstat-DPDK Quick Start Guide</h1>
<ul>
<li><a href="#intro">1. Introduction</a></li>
<li><a href="#inst">2. Installation</a><ul>
<li><a href="#inst-dpdk">2.1 Installing Intel DPDK</a></li>
<li><a href="#inst-tstat-dpdk">2.2 Installing Tstat DPDK</a><ul>
<li><a href="#comp-libtstat">2.2.1 Compiling LibTstat</a></li>
<li><a href="#comp-dpdk-cluster">2.2.2 Compiling DPDK Cluster</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conf">3. System Comfiguration</a><ul>
<li><a href="#conf-hugepage">3.1 Reserve a large number of hugepages to DPDK</a></li>
<li><a href="#conf-cpu">3.2 Force CPUs clock to remain high</a></li>
<li><a href="#alsr">3.3 Disable Address Layout Space Randomization</a></li>
<li><a href="#conf-nics">3.4 Bind NICs to DPDK driver</a></li>
<li><a href="#conf-libtstat">3.5 Set up Tstat configurations</a>  <br />
</li>
</ul>
</li>
<li><a href="#run">4. Run Tstat-DPDK</a><ul>
<li><a href="#start">4.1 Start Tstat Instances</a></li>
<li><a href="#stop">4.2 Stop Tstat Instances</a></li>
<li><a href="#logs">4.3 Log Files Directory</a></li>
<li><a href="#logs-perf">4.4 System Performance Logs</a></li>
</ul>
</li>
</ul>
<h1 id="1-wzxhzdk19wzxhzdk20-introduction">1. <a name="intro"></a> Introduction</h1>
<p>This document reports a quick start guide for Tstat-DPDK, a Tstat version supporting Intel Data Plane Development Kit (DPDK) network packet acquisition framework. Differently from the standard Tstat version, Tstat-DPDK supports multicore processing resulting in significant performance enhancements.</p>
<p>Tstat-DPDK consists of two components currently available at the <a href="http://tstat.polito.it/svn/software/tstat/branches/tstat-dpdk/">official SVN repository</a></p>
<pre><code class="bash">    svn co http://tstat.polito.it/svn/software/tstat/branches/tstat-dpdk/
</code></pre>

<p>The repository contains</p>
<ul>
<li>a performance enhanced Tstat version (currently available under the <code>/tstat-3.0r648</code>)</li>
<li>a DPDK cluster (currently available under <code>/one_copy_cluster_dpdk</code>)</li>
</ul>
<p>Essentially, the DPDK cluster acts as <strong>load balancer</strong>, reading the aggregate traffic and dispatching packets to different <strong>Tstat instances</strong>, i.e., different Tstat processes. By associating different processes to different cores the overall system can sustain multiple 10Gbps of input aggregate traffic.</p>
<p>Here below we provide a step by step guide to setup the overall system.
However, notice that this guide is not meant to be a fine grained tutorial about Intel DPDK not Tstat functioning. For more details, we refer the reader to</p>
<ul>
<li>official <a href="http://tstat.polito.it/HOWTO.shtml">Tstat Howto</a></li>
<li>official Intel <a href="http://dpdk.org/doc">DPDK website</a> and <a href="http://dpdk.org/doc/quick-start">quick start</a></li>
<li>For information about this Readme file and Tstat-DPDK please write to <a href="mailto:martino.trevisan@studenti.polito.it">martino.trevisan@studenti.polito.it</a> or the offical <a href="mailto:tstat@tlc.polito.it">Tstat mailing list</a></li>
</ul>
<h1 id="2-wzxhzdk21wzxhzdk22installation">2. <a name="inst"></a>Installation</h1>
<p>A few general dependences are required before to start</p>
<ul>
<li>Intel DPDK requires  <strong>Intel 82599 based network interfaces</strong></li>
<li>A Debian based Linux distribution with kernel &gt;= 2.6.3</li>
<li>Linux kernel headers: to install run</li>
</ul>
<pre><code class="bash">    sudo apt-get install linux-headers-$(uname -r)
</code></pre>

<ul>
<li>Several package needed before installing this software:</li>
</ul>
<h2 id="21-wzxhzdk23wzxhzdk24installing-intel-dpdk">2.1 <a name="inst-dpdk"></a>Installing Intel DPDK</h2>
<p>We highly recommend to use <strong>Install DPDK v1.7.1</strong>. With other versions it is <strong>NOT</strong> guaranted to work properly.</p>
<p>Software Dependences: <code>make, cmp, sed, grep, arch, glibc.i686, libgcc.i686, libstdc++.i686, glibc-devel.i686, python</code></p>
<pre><code class="bash">    wget http://dpdk.org/browse/dpdk/snapshot/dpdk-1.7.1.tar.gz
    tar xzf dpdk-1.7.1.tar.gz
    cd dpdk-1.7.1
    export RTE_SDK=$(pwd)
    export RTE_TARGET=x86_64-native-linuxapp-gcc
    make install T=$RTE_TARGET
    cd ..
</code></pre>

<p><strong>NOTES:</strong> </p>
<ul>
<li><code>RTE_SDK</code> and <code>RTE_TARGET</code> are two environment variable used by DPDK to handle DPDK applications. These variables have to point respectively to DPDK installation directory and compilation target.</li>
<li>if you are running on a i686 machine, please use <code>i686-native-linuxapp-gcc</code> as <code>RTE_TARGET</code></li>
<li>For documentation we refer the reader to the <a href="http://dpdk.org/doc/intel/dpdk-start-linux-1.7.0.pdf">official documenation</a></li>
</ul>
<h2 id="22-wzxhzdk25wzxhzdk26-installing-tstat-dpdk">2.2 <a name="inst-tstat-dpdk"></a> Installing Tstat DPDK</h2>
<p>Software dependences: <code>libpcap-dev, rrdtool, librrd-dev, autoconf, libtool, cpufrequtils</code></p>
<p>This step require to compile both the DPDK Tstat flavour and the DPDK cluster application. They are both available under the root folder of the SVN repository</p>
<pre><code class="bash">    svn co http://tstat.polito.it/svn/software/tstat/branches/tstat-dpdk/
</code></pre>

<p>As previously pointed out, the DPDK cluster acts as a load balancer in the overall system. From one side it interfaces with the DPDK framework, while on the other it delivers data packets to Tstat processes. For this latter functionality it relies on LibTstat. In the following we refer to the root folder of the repository with <code>$TSTATDPDK</code>.</p>
<h2 id="221-wzxhzdk27wzxhzdk28compiling-libtstat">2.2.1 <a name="comp-libtstat"></a>Compiling LibTstat</h2>
<pre><code class="bash">    cd $TSTATDPDK/tstat-3.0r648
    ./autogen.sh
    ./configure --enable-libtstat
    make
    sudo make install
</code></pre>

<p><strong><em>Note:</em></strong> <code>configure</code> should prompt the following message is the set up is correct</p>
<pre><code>[...]
-------------------------------------------------
  tstat Version 3.0
  -lpcap -lpthread -lm  -lrrd

  Prefix: '/usr/local'

  Package features:
    - pcap      yes
    - zlib      no
    - rrd       yes
    - libtstat  yes
--------------------------------------------------
</code></pre>

<p>This indicates both <code>libpcap</code> and <code>rrdtool</code> libraries have been correctly found and Tstat will be compiled as a library.</p>
<h2 id="222-wzxhzdk29wzxhzdk30compiling-the-dpdk-cluster">2.2.2 <a name="comp-dpdk-cluster"></a>Compiling the DPDK cluster</h2>
<pre><code class="bach">    cd $TSTATDPDK/one_copy_cluster_dpdk
    make clean
    make
</code></pre>

<h1 id="3-wzxhzdk31wzxhzdk32system-configuration">3. <a name="conf"></a>System Configuration</h1>
<p>Before running Tstat-DPDK there are few things to do.</p>
<p><strong>Note:</strong> To simplity the setup, the steps 3.1, 3.2 and 3.3 can be automatically performed using the script <code>one_copy_cluster_dpdk/scripts/configure_machine.sh</code>.
Please verify that script is doing the right operation for your system.</p>
<h2 id="31-wzxhzdk33wzxhzdk34reserve-a-large-number-of-hugepages-to-dpdk">3.1 <a name="conf-hugepage"></a>Reserve a large number of hugepages to DPDK</h2>
<p>To improve memory handling, it is highly recommended to increase the number of <code>hugepages</code> used by the linux kernel. A typical set up would suggest to use <code>512 * N</code> where <code>N</code> is the number of cores (considered as sum of physical and virtual). The size of each huge page is 2MB.</p>
<p>For instance, for a 8 core system this would result in <code>4096 hugepages</code>, i.e., 8GB of memory. In scenarios not suffering of strong memory constraints, we recommend to use <code>6144 hugepages</code>, i.e., 12GB of memory</p>
<pre><code class="bash">    sudo bash -c &quot;echo 6144 &gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages&quot;
    sudo mkdir -p /mnt/huge
    sudo mount -t hugetlbfs nodev /mnt/huge
</code></pre>

<h2 id="32-wzxhzdk35wzxhzdk36force-cpus-clock-to-remain-high">3.2 <a name="conf-cpu"></a>Force CPUs clock to remain high</h2>
<p>To achieve the best performance, your CPU must run always at the highest speed. You need to have installed <code>cpufrequtils</code> package.</p>
<pre><code class="bash">    sudo cpufreq-set -r -g performance
</code></pre>

<h2 id="33-wzxhzdk37wzxhzdk38disable-address-layout-space-randomization">3.3 <a name="alsr"></a>Disable Address Layout Space Randomization</h2>
<p>Address Layout Space Randomization (ALSR) is a useful feature of Linux systems. Unfortunaley sometimes it makes DPDK application not to start.
So we suggest to disable it by means of this command:</p>
<pre><code class="bash">    sudo bash -c &quot;echo 0 &gt; /proc/sys/kernel/randomize_va_space&quot;
</code></pre>

<h2 id="34-wzxhzdk39wzxhzdk40-bind-nics-to-dpdk-driver">3.4 <a name="conf-nics"></a> Bind NICs to DPDK driver</h2>
<p>In able to use the DPDK framework on a NIC we need to change the driver associated to the network card. The driver is located within the <code>kmod</code> folder of the DPDK version compiled (recall the configuration of the <code>RTE_SDK</code> and <code>RTE_TARGET</code> used at compile time).</p>
<p>The following command enable DPDK drivers for all DPDK-supported NICs</p>
<pre><code class="bash">    sudo modprobe uio
    sudo insmod $RTE_SDK/$RTE_TARGET/kmod/igb_uio.ko
    sudo $RTE_SDK/tools/dpdk_nic_bind.py --bind=igb_uio $($RTE_SDK/tools/dpdk_nic_bind.py --status | sed -rn 's,.* if=([^ ]*).*igb_uio *$,\1,p')
</code></pre>

<p>To check if your network interfaces have been properly set by the Intel DPDK enviroment run:</p>
<pre><code class="bash">    sudo $RTE_SDK/tools/dpdk_nic_bind.py --status
</code></pre>

<p>You should get an output like this, which means that the first two interfaces are running under DPDK driver, while the third is not:</p>
<pre><code>Network devices using DPDK-compatible driver
============================================
0000:04:00.0 'Ethernet Controller 10-Gigabit X540-AT2' drv=igb_uio unused=
0000:04:00.1 'Ethernet Controller 10-Gigabit X540-AT2' drv=igb_uio unused=
Network devices using kernel driver
===================================
0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eth0 drv=tg3 unused=igb_uio *Active*
</code></pre>

<p><strong>NOTE:</strong> If for any reason you don't want to bind all the DPDK-supported interfaces to DPDK enviroment, use the <code>dpdk_nic_bind.py</code> as described in the <a href="http://dpdk.org/doc/intel/dpdk-start-linux-1.7.0.pdf">DPDK getting started guide</a>.</p>
<h2 id="35-wzxhzdk41wzxhzdk42set-up-tstat-configurations">3.5  <a name="conf-libtstat"></a>Set up Tstat configurations</h2>
<p>Since multiple Tstat processes will be executed separately, the system will produce separate statistics for each instance. As such, we need to configure each instance separately.</p>
<p>For instance, in <code>one_copy_cluster_dpdk/tstat-conf</code> are provided a set of example configuration files (<code>tstat00.conf</code>, <code>tstat01.conf</code>, etc.) which includes all Tstat plugins, RRDTool output stats and CryptoPAn IP addresses anonymization for log files. Fell free to configure the software as you like.
For more information please refer to the <a href="http://tstat.tlc.polito.it/HOWTO.shtml#libtstat_library">Tstat HOWTO</a></p>
<h1 id="4-wzxhzdk43wzxhzdk44run-tstat-dpdk">4. <a name="run"></a>Run Tstat-DPDK</h1>
<p>The <code>$TSTATDPDK/one_copy_cluster_dpdk/scripts</code> provide useful scripts to starts and stop the data processing.</p>
<p><strong>Note:</strong> if, when running Tstat-DPDK, you encounter an error like this</p>
<pre><code>    error while loading shared libraries: libtstat.so.0: cannot open shared object file: No such file or directory
</code></pre>

<p>run this command to make the enviroment to find <code>libstat</code> shared object:</p>
<pre><code class="bash">    export LD_LIBRARY_PATH=/usr/local/lib
</code></pre>

<h2 id="41-wzxhzdk45wzxhzdk46start-tstat-instances">4.1 <a name="start"></a>Start Tstat Instances</h2>
<p>First of all, you need to decide how many Tstat instances you want to run in parallel. <code>$TSTATDPDK/one_copy_cluster_dpdk/scripts</code> provides 3 quick scripts to lauch 1, 2 or 4 Tstat instances. For instance</p>
<p>If you want to start 2 instances, type:</p>
<pre><code class="bash">    sudo $TSTATDPDK/one_copy_cluster_dpdk/scripts/start_2_instances.sh
</code></pre>

<p>execute Tstat-DPDK splitting the traffic among 2 separate Tstat processes.
All processes run in background (i.e., detached from the shell).</p>
<p>Approximatively every second, the DPDK cluster prints statistics. This includes avg, max, stdev of per packet processing, number of TCP and UDP flows closed, 
incoming rate in Mpps, the eventual packet loss rate (in case of losses),  and utilization of the internal buffers used by Tstat-DPDK to manage packet acquisition.</p>
<p>Below you have an example of this output</p>
<pre><code>Instance: 0 Avg: 1.023us Max: 35.127us StdDev: 14.452 TCP cl.: 42 UDP cl.: 213 Rate: 0.897Mpps, Loss: 0Mpps Buffer occupation:   0%
Instance: 1 Avg: 1.045us Max: 44.345us StdDev: 45.713 TCP cl.: 37 UDP cl.: 175 Rate: 0.813Mpps, Loss: 0Mpps Buffer occupation:   0%
</code></pre>

<h2 id="42-wzxhzdk47wzxhzdk48stop-tstat-instances">4.2 <a name="stop"></a>Stop Tstat Instances</h2>
<p>To stop Tstat-DPDK, run:</p>
<pre><code class="bash">    sudo $TSTATDPDK/one_copy_cluster_dpdk/scripts/quit_instances.sh
</code></pre>

<p>The system will quit and it will print overall statistics on its working divided by network interface and by instance.
The output has this form.</p>
<pre><code>PORT: 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
PORT: 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
    Queue 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%

INSTANCE: 0 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
TSTAT STATISTICS:
Total packets: 0
TCP flows: 0
UDP flows: 0
Time elapsed: 2880.317s

INSTANCE: 1 Rx: 0 Drp: 0 Tot: 0 Perc: -nan%
TSTAT STATISTICS:
Total packets: 0
TCP flows: 0
UDP flows: 0
Time elapsed: 2879.215s
</code></pre>

<h2 id="43-wzxhzdk49wzxhzdk50log-files-directory">4.3 <a name="logs"></a>Log Files Directory</h2>
<p>Tstat produces several log files for different events seen on the network.
Log files are keep separated for each instance and they are put in <code>one_copy_cluster_dpdk/tstatXX.log.out</code> where <code>XX</code> is the number of Tstat instance.
The name of these directories is hardcoded in the software and cannot be modified.</p>
<p>On the contrary, RRD database directory is specified in the configuration files of Tstat, so you can choose its location (recall that each instance must have its different database in different directories).</p>
<h2 id="44-wzxhzdk51wzxhzdk52system-performance-logs">4.4 <a name="logs-perf"></a>System Performance Logs</h2>
<p>In the directory <code>$TSTATDPDK/one_copy_cluster_dpdk/tstat-stats</code> there is a set of file called <code>statsXX.txt</code>.
Each instance writes in its own file (the <code>XX</code> in the name of the file is its number) statistics while it is running.
There are 3 columns which are respectively the mean, the max and the standard deviation of the per packet processing time.</p>
